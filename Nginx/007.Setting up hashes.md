#Setting up hashes
hashes设置

To quickly process static sets of data such as server names, [map ](http://nginx.org/en/docs/http/ngx_http_map_module.html#map)directive’s values, MIME types, names of request header strings, nginx uses hash tables. During the start and each re-configuration nginx selects the minimum possible sizes of hash tables such that the bucket size that stores keys with identical hash values does not exceed the configured parameter (hash bucket size). The size of a table is expressed in buckets. The adjustment is continued until the table size exceeds the hash max size parameter. Most hashes have the corresponding directives that allow changing these parameters, for example, for the server names hash they are [server_names_hash_max_size](http://nginx.org/en/docs/http/ngx_http_core_module.html#server_names_hash_max_size) and [server_names_hash_bucket_size](http://nginx.org/en/docs/http/ngx_http_core_module.html#server_names_hash_bucket_size).

为快速处理静态数据设置，例如文件名、 [map ](http://nginx.org/en/docs/http/ngx_http_map_module.html#map)指令值、MIME类型，请求头字符串名，nginx使用s hash表格。在启动及每次重新配置时，nginx选择最小可用的的hash表格，因此存储keys的存储桶量（bucket size）使用恒一的hash值，其不能超过配置参数(hash bucket size)。表格的大小代表buckets。直到表格大小超过了hash的最大参数后才会停止调节。大多数hash具有相应的指令来对这些参数进行修改，例如服务器名hash是：[server_names_hash_max_size](http://nginx.org/en/docs/http/ngx_http_core_module.html#server_names_hash_max_size) and [server_names_hash_bucket_size](http://nginx.org/en/docs/http/ngx_http_core_module.html#server_names_hash_bucket_size) 。

The hash bucket size parameter is aligned to the size that is a multiple of the processor’s cache line size. This speeds up key search in a hash on modern processors by reducing the number of memory accesses. If hash bucket size is equal to one processor’s cache line size then the number of memory accesses during the key search will be two in the worst case — first to compute the bucket address, and second during the key search inside the bucket. Therefore, if nginx emits the message requesting to increase either hash max size or hash bucket size then the first parameter should first be increased.

hash bucket大小参数与进程的缓存线（cache line）大小的倍数一致。这种方式通过减少内存访问量可以提高现代处理器hash中key的查找速度。如果hash bucket大小等于进程的缓存线大小，那么在进行key查找时的内存访问量会有两种最坏的情况发生：第一种是在计算bucket地址时，第二种是在bucket中进行key查找时。因此，如果nginx发出消息来请求增加hash最大值或hash bucket大小，那么第一个参数会首先被增加。  

[返回](000.Content.md)